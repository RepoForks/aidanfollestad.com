<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Capture and Playback Tests</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1E88E5">

    <!-- Video.js -->
    <link href="//vjs.zencdn.net/5.8/video-js.min.css" rel="stylesheet">
    <script src="//vjs.zencdn.net/5.8/video.min.js"></script>

    <!-- WaveSurfer -->
    <script src="//collab-project.github.io/videojs-wavesurfer/dist/wavesurfer.min.js"></script>
    <script src="//collab-project.github.io/videojs-wavesurfer/dist/wavesurfer.microphone.min.js"></script>

    <!-- VideoJS.Record and Related Plugins -->
    <script src="/videojs-record/videojs.record.min.js"></script>
    <script src="/videojs-record/videojs.wavesurfer.js"></script>
    <link href="/videojs-record/css/videojs.record.min.css" rel="stylesheet">

    <!-- RecordRTC -->
    <script src="//cdn.webrtc-experiment.com/RecordRTC.js"></script>

    <!-- jQuery -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

    <!-- Materialize -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script>

    <!-- Internal -->
    <link href="/videojs-record/css/captureandplay.css" rel="stylesheet">

</head>
<body>

<nav>
    <div class="nav-wrapper blue">
        <a href="#" class="brand-logo">Capture and Playback Tests</a>
    </div>
</nav>

<div id="body-content">

    <h5>Video Capture</h5>
    <video id="myVideo" class="video-js vjs-default-skin"></video>

    <hr/>

    <h5>Audio Capture</h5>
    <audio id="myAudio" class="video-js vjs-default-skin"></audio>

    <hr/>

    <h5>Image Capture</h5>
    <video id="myImage" class="video-js vjs-default-skin"></video>

    <hr/>

    <h5>Audio Playback</h5>
    <div id="waveform" style="max-width: 50%"></div>
    <button style="margin-top: 24px" class="btn waves-effect waves-light light-blue" onclick="wavesurfer.playPause()">Play/Pause</button>

    <hr/>

    <h5>Video Playback</h5>
    <video id="videoPlayback" width="320" height="240" controls>
        <source src="https://s3.amazonaws.com/prod-extempore-expertfiles/001f0346-a03f-4a18-bb3a-d1f97eec12a4.mp4"
                type="video/mp4">
        Your browser does not support the video tag.
    </video>

</div>

<script>

    var wavesurfer;

    $(document).ready(function () {

        var contentWidth = $('#body-content').width();

        var defaultVideoWidth = 320;
        var defaultVideoHeight = 240;
        if (defaultVideoWidth > contentWidth) {
            defaultVideoWidth = contentWidth;
            defaultVideoHeight = contentWidth / (defaultVideoWidth / defaultVideoHeight);
        }

        var videoPlayback = $('#videoPlayback');
        videoPlayback.attr('width', defaultVideoWidth);
        videoPlayback.attr('height', defaultVideoHeight);

        var videoPlayer = videojs("myVideo",
                {
                    controls: true,
                    width: defaultVideoWidth,
                    height: defaultVideoHeight,
                    plugins: {
                        record: {
                            audio: true,
                            video: true,
                            maxLength: 10,
                            debug: true
                        }
                    }
                });

        // error handling
        videoPlayer.on('deviceError', function () {
            console.log('device error:', videoPlayer.deviceErrorCode);
        });
        videoPlayer.on('error', function (error) {
            console.log('error:', error);
        });

        // user clicked the record button and started recording
        videoPlayer.on('startRecord', function () {
            console.log('started recording!');
        });

        // user completed recording and stream is available
        videoPlayer.on('finishRecord', function () {
            // the blob object contains the recorded data that
            // can be downloaded by the user, stored on server etc.
            console.log('finished recording: ', videoPlayer.recordedData);
        });

        var defaultAudioWidth = 600;
        var defaultAudioHeight = 300;
        if (defaultAudioWidth > contentWidth) {
            defaultAudioWidth = contentWidth;
            defaultAudioHeight = contentWidth / (defaultAudioWidth / defaultAudioHeight);
        }

        var waveform = $('#waveform');
        waveform.attr('width', defaultAudioWidth);
        waveform.attr('height', defaultAudioHeight);

        var audioPlayer = videojs("myAudio",
                {
                    controls: true,
                    width: defaultAudioWidth,
                    height: defaultAudioHeight,
                    plugins: {
                        wavesurfer: {
                            src: "live",
                            waveColor: "black",
                            progressColor: "#2E732D",
                            cursorWidth: 1,
                            msDisplayMax: 20,
                            hideScrollbar: true
                        },
                        record: {
                            audio: true,
                            video: false,
                            maxLength: 20,
                            debug: true
                        }
                    }
                });
        // error handling
        audioPlayer.on('deviceError', function () {
            console.log('device error:', audioPlayer.deviceErrorCode);
        });

        // user clicked the record button and started recording
        audioPlayer.on('startRecord', function () {
            console.log('started recording!');
        });

        // user completed recording and stream is available
        audioPlayer.on('finishRecord', function () {
            // the blob object contains the recorded data that
            // can be downloaded by the user, stored on server etc.
            console.log('finished recording: ', audioPlayer.recordedData);
        });

        var imagePlayer = videojs("myImage",
                {
                    controls: true,
                    width: defaultVideoWidth,
                    height: defaultVideoHeight,
                    controlBar: {
                        volumeMenuButton: false,
                        fullscreenToggle: false
                    },
                    plugins: {
                        record: {
                            image: true,
                            debug: true
                        }
                    }
                });
        // error handling
        imagePlayer.on('deviceError', function () {
            console.warn('device error:', imagePlayer.deviceErrorCode);
        });

        // snapshot is available
        imagePlayer.on('finishRecord', function () {
            // the blob object contains the image data that
            // can be downloaded by the user, stored on server etc.
            console.log('snapshot ready: ', imagePlayer.recordedData);
        });

        wavesurfer = WaveSurfer.create({
            container: '#waveform',
            waveColor: 'black',
            progressColor: 'blue',
            maxCanvasWidth: defaultAudioWidth
        });
        wavesurfer.load('https://s3.amazonaws.com/prod-extempore-expertfiles/01bef097-91c2-4195-a288-f6877e27ce0c.wav');
    });
</script>

</body>
</html>